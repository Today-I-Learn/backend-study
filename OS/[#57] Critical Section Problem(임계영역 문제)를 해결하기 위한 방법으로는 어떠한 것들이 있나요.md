 ### Critical Section(임계영역) 이란?

임계영역이란 동일한 자원을 동시에 접근하는 작업을 실행하는 코드의 영역을 의미합니다. 다시말해 프로세스간에 공유자원을 접근하는데 있어서 문제가 발생하지 않도록 한번에 하나의 프로세스만 이용하게끔 보장해줘야하는 영역입니다.
여기서 프로세스들이 임계영역을 동시에 사용할 수 있게 되는 경우를 critical section problem(임계영역 문제)라고 합니다.
임계영역 문제를 해결하기 위해서는 Mutual exclusion (상호 배제), Progress(진행), Bounded waiting(한정 대기)라는 3가지 조건을 만족해야합니다.

Mutual Exclusion 은 한 프로세스가 이미 임계영역에서 실행 중이라면, 다른 프로세스들은 임계영역에 들어 갈 수 없다는 의미입니다.
Progress 는 임계영역에서 실행중인 프로세스가 없는 상태에서 임계영역에 들어 갈 프로세스를 결정하는 것이 유한시간 이내에 이루어져야한다는 것 입니다.
마지막으로 Bounden waiting 은 다른 프로세스의 starvation 를 방지하기 위해 한번 임계영역에 들어간 프로세스는 다음 순서까지 제한이 필요하다는 것 입니다.

 ### Critical Section Problem 의 해결책
 
 임계영역 문제를 해결하기 위한 방법으로는 Lock, semaphore 그리고 모니터 등이 있습니다.
 
 Lock 은 하드웨어 기반 해결책으로써, 동시에 공유 자원에 접근하는것을 막기 위해 임계영역에 진입하는 프로세스는 lock을 획득하고 임계영역을 빠져나올 때 lock을 방출함으로써 동시에 접근이 안되도록 처리하는 방식입니다.
 Lock 의 단점으로는 특정 상황에서 제대로 작동하지 않을 수도 있다는 점입니다. 만약 A 스레드가 lock을 실행시켜 무한루프를 돌게끔 변수의 값을 변경하기 전에 인터럽트가 걸려 값을 변경하지 못하고 다른 스레드가 lock 함수에 들어오게 된다면 두개의 스레드가 임계영역에 존재하는 상황이 발생 할 수 잇습니다.
 
semaphore는 소프트웨어상에서 임계영역 문제를 해결하기 위한 동기화 도구 입니다.

세마포어는 카운팅 세마포어(counting semaphore) 와 이진 세마포어(binary semaphore)로 구분할 수 있는데 카운팅 세마포어는 가용한 개수를 가진 자원에 대한 접근 제어용으로 사용되며, 세마포어는 가용한 자원의 개수로 초기화 됩니다.
자원을 사용하면 세마포어가 감소하고 방출하면 증가하는 방식으로 작동하게 됩니다.
이진 세마포어의 경우 mutex 라고도 불리우며 0과 1 사이의 값만 사용이 가능하며 다중 프로세스들 사이의 임계영역 문제를 해결하기 위해 사용됩니다.
세마포어의 단점으로는 Busy Waiting이 있으며 이는 Spin lock이라고 불리는 Semaphore 초기 버전에서 Critical Section 에 진입해야하는 프로세스는 진입 코드를 계속 반복 실행해야 하며, CPU 시간을 낭비했습니다. 
이를 Busy Waiting이라고 부르며 특수한 상황이 아니면 비효율적이며 일반적으로는 세마포어에서 임계영역에 진입을 시도했지만 실패한 프로세스에 대해 Block시킨 뒤, 임계영역에 자리가 날 때 다시 깨우는 방식을 사용합니다. 이 경우 Busy waiting으로 인한 시간낭비 문제를 해결 할 수 있습니다.
또한 세마포어가 Ready Queue 를 가지고 있고, 둘 이상의 프로세스가 임계영역 진입을 무한정 기다리고 있고, 임계영역에서 실행되는 프로세스는 진입 대기 중인 프로세스가 실행되야만 빠져나올 수 있는 상황인 deadlock을 유발할 수 있습니다.

